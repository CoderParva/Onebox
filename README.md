# üì• Onebox - AI-Powered Email Aggregator

A feature-rich Onebox that synchronizes multiple IMAP accounts in real-time, indexes mail for high-speed search using **Elasticsearch**, categorizes emails using a **local LLM (Ollama)**, and generates contextual replies using **RAG** (Retrieval-Augmented Generation) and **ChromaDB**.

## üöÄ Features Implemented (100% Complete)

| Requirement | Status | Implementation |
| :--- | :--- | :--- |
| **1. Real-Time Sync (Multi-Account)** | **‚úÖ Complete** | Uses persistent IMAP connections (IDLE mode) to fetch mail instantly. Architecture supports connecting to multiple accounts simultaneously. |
| **2. Searchable Storage** | **‚úÖ Complete** | Emails are stored, indexed, and made searchable via a Dockerized Elasticsearch v9.2 instance. |
| **3. AI-Based Categorization** | **‚úÖ Complete** | Integrates with **Ollama** running locally (Llama 3:8b) to categorize emails into labels like *Interested*, *Spam*, *Meeting Booked*, etc. |
| **4. Slack & Webhook Integration** | **‚úÖ Complete** | Automatically triggers webhooks and sends Slack notifications when an email is categorized as *Interested*. |
| **5. Frontend Interface** | **‚úÖ Complete** | A React/TypeScript UI that supports instant search, folder filtering, and real-time push notifications via WebSockets. |
| **6. AI-Powered Suggested Replies (RAG)** | **‚úÖ Complete (Bonus)** | Uses **ChromaDB** (Vector Database) to retrieve context and provides suggested, human-like replies generated by the local LLM. |

## üõ†Ô∏è Tech Stack

| Layer | Component | Purpose |
| :--- | :--- | :--- |
| **Backend** | Node.js, TypeScript, Express | REST API, WebSocket server, Service orchestration. |
| **Database/Vector** | Elasticsearch v9.2, ChromaDB | High-speed indexing/search, and vector store for RAG context. |
| **AI/LLM** | **Ollama** (Local Llama 3:8b) | LLM for categorization and RAG reply generation. *Eliminates reliance on external cloud APIs.* |
| **Real-Time** | `node-imap`, `ws` | IMAP IDLE mode and WebSocket broadcast for instant UI updates. |
| **Frontend** | React, Vite, `react-hot-toast` | Modern UI with client-side routing and real-time notifications. |

-----

## ‚öôÔ∏è Setup & Installation Guide

This project requires a few external tools. The recommended method is to use the automated batch files provided, which ensure all environment settings are correct.

### Prerequisites (Manual Installation)

The following must be installed on the host machine:

1.  **Docker Desktop** (Required for Elasticsearch and ChromaDB).
2.  **Ollama** (Required for the local AI models).
3.  **Node.js & npm** (LTS version, v18+).

### Step 1: Clone and Configure

1.  Clone the repository:
    ```bash
    git clone https://github.com/your_username/onebox-assignment.git
    cd onebox-assignment
    ```
2.  Install all Python and Node dependencies automatically:
    ```bash
    npm install
    cd ui
    npm install
    cd ..
    ```

### Step 2: Configure Environment (`.env`)

Create a **`.env`** file in the project root and fill in the following details. **IMAP requires an App Password.**

```ini
# --- IMAP ACCOUNT 1 (Primary) ---
IMAP_USER=your-email@gmail.com
IMAP_PASSWORD=your-16-character-app-password
IMAP_HOST=imap.gmail.com
IMAP_PORT=993
IMAP_TLS=true

# --- IMAP ACCOUNT 2 (For multi-account demo) ---
IMAP_USER_2=second-email@gmail.com
IMAP_PASSWORD_2=second-app-password
IMAP_HOST_2=imap.gmail.com

# --- INTEGRATIONS ---
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
WEBHOOK_SITE_URL=https://webhook.site/...
```

### Step 3: Run the System

To start the databases, AI, and both servers efficiently:

1.  **Double-click `run-all.bat`**.

This script will perform the following actions sequentially:

  * Start all **Docker** containers (`up -d`).
  * Install the required **Ollama models** (`llama3:8b` and `nomic-embed-text`).
  * Launch **Ollama**, the **Backend**, and the **Frontend** in a single terminal window using `concurrently`.

-----

## üõë Stopping the System

To shut down everything cleanly:

1.  In the `concurrently` terminal window, press **`Ctrl + C`** to stop the Node and Ollama servers.
2.  Double-click **`shutdown-all.bat`** to gracefully stop the Docker containers.

-----

## üîé Postman Endpoints (For Backend Showcase)

The core services can be verified using these endpoints:

| Method | Endpoint | Purpose |
| :--- | :--- | :--- |
| `GET` | `/api/emails` | Fetches emails for the default account (or specified `accountId`). Supports `?search=term` and `?folder=INBOX`. |
| `POST` | `/api/sync` | Manually triggers the IMAP sync process for all connected accounts. |
| `POST` | `/api/suggest-reply` | Accepts `{ "emailBody": "..." }` and returns a contextual reply based on RAG. |